generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                          Int                          @id @default(autoincrement())
  name                        String
  email                       String                       @unique
  password                    String?
  phone                       String?
  is_admin                    String                       @default("false")
  is_active                   String                       @default("true")
  role_id                     Int?
  company_id                  Int
  two_factor_enabled          Boolean                      @default(false)
  two_factor_secret           String?
  two_factor_backup_codes     String?
  email_verified              Boolean                      @default(false)
  email_verification_token    String?
  email_verification_expires  DateTime?
  password_reset_token        String?
  password_reset_expires      DateTime?
  last_login_at               DateTime?
  last_login_ip               String?
  avatar_url                  String?
  created_at                  DateTime                     @default(now())
  updated_at                  DateTime                     @updatedAt
  created_announcements       Announcement[]
  created_complaints          Complaint[]
  complaint_followups         ComplaintFollowup[]
  assigned_leads              Lead[]                       @relation("AssignedLeads")
  created_leads               Lead[]                       @relation("CreatedLeads")
  created_followups           LeadFollowup[]
  oauth_tokens                OAuthToken[]
  created_inspections         PropertyInspection[]
  created_insurance           PropertyInsurance[]
  created_maintenance_history PropertyMaintenanceHistory[]
  notifications               PropertyNotification[]       @relation("UserNotifications")
  created_valuations          PropertyValuation[]
  assigned_viewings           PropertyViewing[]            @relation("AssignedViewings")
  created_viewings            PropertyViewing[]            @relation("CreatedViewings")
  provider_accounts           ProviderAccount[]
  created_receipts            Receipt[]
  approved_approvals          RentalApproval[]             @relation("ApprovedApprovals")
  created_approvals           RentalApproval[]             @relation("CreatedApprovals")
  created_rental_contracts    RentalContract[]             @relation("CreatedRentalContracts")
  salesman_rental_contracts   RentalContract[]             @relation("SalesmanRental")
  created_requests            Request[]
  created_sales_contracts     SalesContract[]              @relation("CreatedSalesContracts")
  salesman_sales_contracts    SalesContract[]              @relation("SalesmanSales")
  sessions                    Session[]
  assigned_tickets            Ticket[]                     @relation("AssignedTickets")
  created_tickets             Ticket[]                     @relation("CreatedTickets")
  ticket_comments             TicketComment[]
  ticket_followups            TicketFollowup[]
  user_favorites              UnitFavorite[]               @relation("UserFavorites")
  company                     Company                      @relation(fields: [company_id], references: [id], onDelete: NoAction)
  role                        Role?                        @relation(fields: [role_id], references: [id])

  @@index([email])
  @@index([company_id])
  @@index([role_id])
  @@index([email_verified])
  @@index([two_factor_enabled])
}

model Company {
  id                   Int                          @id @default(autoincrement())
  name                 String
  hosting_id           Int?
  created_at           DateTime                     @default(now())
  activity_sources     ActivitySource[]
  amenities            Amenity[]
  announcements        Announcement[]
  areas                Area[]
  brokers              Broker[]
  buildings            Building[]
  hosting              Hosting?                     @relation(fields: [hosting_id], references: [id])
  settings             CompanySettings?
  complaints           Complaint[]
  complaint_statuses   ComplaintStatus[]
  countries            Country[]
  followup_types       FollowupType[]
  kyc_doc_types        KycDocType[]
  landlords            Landlord[]
  leads                Lead[]
  lead_followups       LeadFollowup[]               @relation("LeadFollowupCompany")
  lead_statuses        LeadStatus[]
  maintenance_statuses MaintenanceStatus[]
  maintenance_types    MaintenanceType[]
  parkings             Parking[]
  payment_under        PaymentUnder[]
  permissions          Permission[]
  analytics            PropertyAnalytics[]
  inspections          PropertyInspection[]         @relation("PropertyInspectionCompany")
  insurances           PropertyInsurance[]          @relation("PropertyInsuranceCompany")
  maintenance_history  PropertyMaintenanceHistory[] @relation("PropertyMaintenanceHistoryCompany")
  notifications        PropertyNotification[]
  valuations           PropertyValuation[]          @relation("PropertyValuationCompany")
  viewings             PropertyViewing[]
  receipts             Receipt[]
  approvals            RentalApproval[]
  contracts            RentalContract[]
  requests             Request[]
  request_statuses     RequestStatus[]
  request_types        RequestType[]
  roles                Role[]
  sales_contracts      SalesContract[]
  states               State[]
  tenants              Tenant[]
  tickets              Ticket[]
  users                User[]
  vehicles             Vehicle[]
  units                unit[]
  unit_types           unitType[]

  @@index([hosting_id], map: "Company_hosting_id_fkey")
}

model Hosting {
  id        Int       @id @default(autoincrement())
  name      String
  companies Company[]
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String
  company_id  Int
  created_at  DateTime     @default(now())
  company     Company      @relation(fields: [company_id], references: [id], onDelete: NoAction)
  users       User[]
  permissions Permission[] @relation("PermissionToRole")

  @@index([company_id])
}

model Permission {
  id          Int      @id @default(autoincrement())
  name        String
  category    String
  description String?
  company_id  Int
  created_at  DateTime @default(now())
  company     Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  roles       Role[]   @relation("PermissionToRole")

  @@index([company_id])
}

model OAuthToken {
  id            Int      @id @default(autoincrement())
  user_id       Int
  access_token  String   @unique
  refresh_token String?  @unique
  expires_at    DateTime
  created_at    DateTime @default(now())
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([access_token])
}

model Session {
  id            Int      @id @default(autoincrement())
  user_id       Int
  session_token String   @unique
  ip_address    String?
  user_agent    String?
  device_type   String?
  device_name   String?
  is_active     Boolean  @default(true)
  expires_at    DateTime
  last_activity DateTime @default(now())
  created_at    DateTime @default(now())
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([session_token])
  @@index([expires_at])
}

model ProviderAccount {
  id                  Int       @id @default(autoincrement())
  user_id             Int
  provider            String
  provider_account_id String
  provider_email      String?
  provider_name       String?
  access_token        String?
  refresh_token       String?
  expires_at          DateTime?
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  user                User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([provider, provider_account_id], name: "provider_provider_account_id")
  @@index([user_id])
  @@index([provider])
}

model Tenant {
  id                 Int               @id @default(autoincrement())
  name               String
  email              String
  phone_no           String
  mobile_no          String
  emirates_id        String
  emirates_id_expiry DateTime?
  residential        String
  nationality        String
  passport_no        String
  passport_expiry    DateTime
  fax                String?
  address            String
  company_id         Int
  created_at         DateTime          @default(now())
  complaints         Complaint[]
  kyc_documents      KycDocument[]
  viewings           PropertyViewing[]
  approvals          RentalApproval[]
  contracts          RentalContract[]
  requests           Request[]
  company            Company           @relation(fields: [company_id], references: [id], onDelete: NoAction)
  tickets            Ticket[]

  @@index([email])
  @@index([company_id])
}

model Landlord {
  id                 Int             @id @default(autoincrement())
  name               String
  email              String
  phone_no           String
  mobile_no          String
  emirates_id        String
  emirates_id_expiry DateTime?
  residential        String
  nationality        String
  passport_no        String
  passport_expiry    DateTime
  fax                String?
  address            String
  company_id         Int
  created_at         DateTime        @default(now())
  complaints         Complaint[]
  kyc_documents      KycDocument[]
  company            Company         @relation(fields: [company_id], references: [id], onDelete: NoAction)
  requests           Request[]
  buyer_contracts    SalesContract[] @relation("BuyerContracts")
  sales_contracts    SalesContract[] @relation("SellerContracts")
  tickets            Ticket[]
  units              unit[]

  @@index([email])
  @@index([company_id])
}

model KycDocument {
  id          Int        @id @default(autoincrement())
  tenant_id   Int?
  landlord_id Int?
  doc_type_id Int
  path        String
  created_at  DateTime   @default(now())
  doc_type    KycDocType @relation(fields: [doc_type_id], references: [id], onDelete: NoAction)
  landlord    Landlord?  @relation(fields: [landlord_id], references: [id], onDelete: Cascade)
  tenant      Tenant?    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
  @@index([landlord_id])
  @@index([doc_type_id], map: "KycDocument_doc_type_id_fkey")
}

model KycDocType {
  id            Int                @id @default(autoincrement())
  name          String
  is_mandatory  String             @default("false")
  company_id    Int
  created_at    DateTime           @default(now())
  handover_docs HandoverDocument[]
  company       Company            @relation(fields: [company_id], references: [id], onDelete: NoAction)
  documents     KycDocument[]

  @@index([company_id])
}

model Country {
  id         Int      @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime @default(now())
  company    Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  states     State[]

  @@index([company_id])
}

model State {
  id               Int      @id @default(autoincrement())
  name             String
  authorative_name String?
  country_id       Int
  company_id       Int
  created_at       DateTime @default(now())
  areas            Area[]
  company          Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  country          Country  @relation(fields: [country_id], references: [id], onDelete: NoAction)

  @@index([country_id])
  @@index([company_id])
}

model Area {
  id               Int                 @id @default(autoincrement())
  name             String
  state_id         Int
  company_id       Int
  created_at       DateTime            @default(now())
  company          Company             @relation(fields: [company_id], references: [id], onDelete: NoAction)
  state            State               @relation(fields: [state_id], references: [id], onDelete: NoAction)
  buildings        Building[]
  lead_preferences LeadPreferredArea[]

  @@index([state_id])
  @@index([company_id])
}

model Building {
  id              Int       @id @default(autoincrement())
  name            String
  completion_date DateTime?
  is_exempt       String    @default("false")
  status          String    @default("active")
  area_id         Int
  company_id      Int
  created_at      DateTime  @default(now())
  area            Area      @relation(fields: [area_id], references: [id], onDelete: NoAction)
  company         Company   @relation(fields: [company_id], references: [id], onDelete: NoAction)
  floors          Floor[]
  parkings        Parking[]
  units           unit[]

  @@index([area_id])
  @@index([company_id])
}

model Floor {
  id          Int      @id @default(autoincrement())
  name        String
  building_id Int
  created_at  DateTime @default(now())
  building    Building @relation(fields: [building_id], references: [id], onDelete: Cascade)
  units       unit[]

  @@index([building_id])
}

model unit {
  id                  Int                          @id @default(autoincrement())
  name                String
  gross_area_in_sqft  Float
  ownership           String
  basic_rent          Float?
  basic_sale_value    Float?
  is_exempt           String                       @default("false")
  premise_no          String
  status              String                       @default("available")
  property_type       String
  no_of_bathrooms     Int
  no_of_bedrooms      Int?
  no_of_parkings      Int?
  ejari_number        String?
  ejari_expiry        DateTime?
  dewa_account        String?
  municipality_fees   Float?
  furnished_type      String?
  view_type           String?
  floor_number        Int?
  total_floors        Int?
  year_built          Int?
  listing_type        String?
  is_featured         Boolean                      @default(false)
  is_verified         Boolean                      @default(false)
  virtual_tour_url    String?
  description         String?                      @db.Text
  latitude            Float?
  longitude           Float?
  building_id         Int
  floor_id            Int
  unit_type_id        Int
  owned_by            Int?
  company_id          Int
  created_at          DateTime                     @default(now())
  updated_at          DateTime                     @updatedAt
  analytics           PropertyAnalytics[]          @relation("UnitAnalytics")
  inspections         PropertyInspection[]
  insurance           PropertyInsurance[]
  maintenance_history PropertyMaintenanceHistory[]
  notifications       PropertyNotification[]       @relation("UnitNotifications")
  valuations          PropertyValuation[]
  viewings            PropertyViewing[]
  approvals           RentalApproval[]
  rental_contracts    RentalContractunit[]
  sales_contracts     SalesContractunit[]
  tickets             Ticket[]
  documents           UnitDocument[]
  favorites           UnitFavorite[]
  images              UnitImage[]
  building            Building                     @relation(fields: [building_id], references: [id], onDelete: NoAction)
  company             Company                      @relation(fields: [company_id], references: [id], onDelete: NoAction)
  floor               Floor                        @relation(fields: [floor_id], references: [id], onDelete: NoAction)
  landlord            Landlord?                    @relation(fields: [owned_by], references: [id])
  unit_type           unitType                     @relation(fields: [unit_type_id], references: [id], onDelete: NoAction)
  amenities           unitAmenity[]

  @@index([building_id])
  @@index([floor_id])
  @@index([unit_type_id])
  @@index([company_id])
  @@index([status])
  @@index([ejari_number])
  @@index([is_featured])
  @@index([listing_type])
  @@index([owned_by], map: "unit_owned_by_fkey")
}

model UnitImage {
  id            Int      @id @default(autoincrement())
  unit_id       Int
  image_url     String
  image_type    String?
  caption       String?
  display_order Int      @default(0)
  is_primary    Boolean  @default(false)
  created_at    DateTime @default(now())
  unit          unit     @relation(fields: [unit_id], references: [id], onDelete: Cascade)

  @@index([unit_id])
  @@index([is_primary])
}

model UnitDocument {
  id            Int       @id @default(autoincrement())
  unit_id       Int
  doc_type      String
  document_url  String
  document_name String?
  expiry_date   DateTime?
  created_at    DateTime  @default(now())
  unit          unit      @relation(fields: [unit_id], references: [id], onDelete: Cascade)

  @@index([unit_id])
  @@index([doc_type])
}

model unitType {
  id               Int                     @id @default(autoincrement())
  name             String
  company_id       Int
  created_at       DateTime                @default(now())
  lead_preferences LeadPreferredunitType[]
  units            unit[]
  company          Company                 @relation(fields: [company_id], references: [id], onDelete: NoAction)

  @@index([company_id])
}

model Amenity {
  id               Int                    @id @default(autoincrement())
  name             String
  company_id       Int
  created_at       DateTime               @default(now())
  company          Company                @relation(fields: [company_id], references: [id], onDelete: NoAction)
  lead_preferences LeadPreferredAmenity[]
  unit_amenities   unitAmenity[]

  @@index([company_id])
}

model unitAmenity {
  id         Int     @id @default(autoincrement())
  unit_id    Int
  amenity_id Int
  amenity    Amenity @relation(fields: [amenity_id], references: [id], onDelete: Cascade)
  unit       unit    @relation(fields: [unit_id], references: [id], onDelete: Cascade)

  @@unique([unit_id, amenity_id])
  @@index([amenity_id], map: "unitAmenity_amenity_id_fkey")
}

model Parking {
  id          Int               @id @default(autoincrement())
  name        String
  building_id Int
  company_id  Int
  created_at  DateTime          @default(now())
  contracts   ContractParking[]
  building    Building          @relation(fields: [building_id], references: [id], onDelete: NoAction)
  company     Company           @relation(fields: [company_id], references: [id], onDelete: NoAction)

  @@index([building_id])
  @@index([company_id])
}

model Vehicle {
  id           Int               @id @default(autoincrement())
  vehicle_no   String
  vehicle_type String?
  company_id   Int
  created_at   DateTime          @default(now())
  parkings     ContractParking[]
  company      Company           @relation(fields: [company_id], references: [id], onDelete: NoAction)

  @@index([company_id])
}

model RentalContract {
  id                      Int                  @id @default(autoincrement())
  contract_no             String               @unique
  contract_date           DateTime
  from_date               DateTime
  to_date                 DateTime
  amount                  Float
  security_amount         Float
  service_amount          Float
  payment_terms           String
  grace_period            String?
  tentative_move_in       DateTime
  vat_details             String?
  payment_method          String
  preclose_date           DateTime?
  preclose_reason         String?
  vat_amount              Float?
  management_fee          Float?
  previous_contract_id    Int?
  ejari_registered        Boolean              @default(false)
  ejari_number            String?
  ejari_registration_date DateTime?
  ejari_expiry_date       DateTime?
  agent_commission        Float?
  broker_commission       Float?
  commission_paid         Boolean              @default(false)
  tenant_id               Int
  salesman_id             Int
  broker_id               Int?
  company_id              Int
  created_by              Int
  created_at              DateTime             @default(now())
  updated_at              DateTime             @updatedAt
  parkings                ContractParking[]    @relation("RentalContractParking")
  handover                Handover?            @relation("RentalContractHandover")
  receipts                Receipt[]            @relation("RentalContractReceipt")
  broker                  Broker?              @relation("BrokerRental", fields: [broker_id], references: [id])
  company                 Company              @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator                 User                 @relation("CreatedRentalContracts", fields: [created_by], references: [id], onDelete: NoAction)
  previous_contract       RentalContract?      @relation("ContractRenewals", fields: [previous_contract_id], references: [id])
  renewed_contracts       RentalContract[]     @relation("ContractRenewals")
  salesman                User                 @relation("SalesmanRental", fields: [salesman_id], references: [id], onDelete: NoAction)
  tenant                  Tenant               @relation(fields: [tenant_id], references: [id], onDelete: NoAction)
  units                   RentalContractunit[]

  @@index([contract_no])
  @@index([tenant_id])
  @@index([company_id])
  @@index([ejari_number])
  @@index([broker_id], map: "RentalContract_broker_id_fkey")
  @@index([created_by], map: "RentalContract_created_by_fkey")
  @@index([previous_contract_id], map: "RentalContract_previous_contract_id_fkey")
  @@index([salesman_id], map: "RentalContract_salesman_id_fkey")
}

model SalesContract {
  id                Int                 @id @default(autoincrement())
  contract_no       String              @unique
  contract_date     DateTime
  amount            Float
  service_amount    Float
  payment_terms     String
  status            String?
  agent_commission  Float?
  broker_commission Float?
  commission_paid   Boolean             @default(false)
  seller_id         Int
  buyer_id          Int
  salesman_id       Int
  broker_id         Int?
  company_id        Int
  created_by        Int
  created_at        DateTime            @default(now())
  updated_at        DateTime            @updatedAt
  parkings          ContractParking[]   @relation("SalesContractParking")
  handover          Handover?           @relation("SalesContractHandover")
  receipts          Receipt[]           @relation("SalesContractReceipt")
  broker            Broker?             @relation("BrokerSales", fields: [broker_id], references: [id])
  buyer             Landlord            @relation("BuyerContracts", fields: [buyer_id], references: [id], onDelete: NoAction)
  company           Company             @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator           User                @relation("CreatedSalesContracts", fields: [created_by], references: [id], onDelete: NoAction)
  salesman          User                @relation("SalesmanSales", fields: [salesman_id], references: [id], onDelete: NoAction)
  seller            Landlord            @relation("SellerContracts", fields: [seller_id], references: [id], onDelete: NoAction)
  units             SalesContractunit[]

  @@index([contract_no])
  @@index([seller_id])
  @@index([buyer_id])
  @@index([company_id])
  @@index([broker_id], map: "SalesContract_broker_id_fkey")
  @@index([created_by], map: "SalesContract_created_by_fkey")
  @@index([salesman_id], map: "SalesContract_salesman_id_fkey")
}

model RentalContractunit {
  id          Int            @id @default(autoincrement())
  contract_id Int
  unit_id     Int
  contract    RentalContract @relation(fields: [contract_id], references: [id], onDelete: Cascade)
  unit        unit           @relation(fields: [unit_id], references: [id], onDelete: NoAction)

  @@unique([contract_id, unit_id])
  @@index([unit_id], map: "RentalContractunit_unit_id_fkey")
}

model SalesContractunit {
  id          Int           @id @default(autoincrement())
  contract_id Int
  unit_id     Int
  contract    SalesContract @relation(fields: [contract_id], references: [id], onDelete: Cascade)
  unit        unit          @relation(fields: [unit_id], references: [id], onDelete: NoAction)

  @@unique([contract_id, unit_id])
  @@index([unit_id], map: "SalesContractunit_unit_id_fkey")
}

model ContractParking {
  id              Int            @id @default(autoincrement())
  contract_id     Int
  contract_type   String
  parking_id      Int
  vehicle_id      Int?
  parking         Parking        @relation(fields: [parking_id], references: [id], onDelete: NoAction)
  rental_contract RentalContract? @relation("RentalContractParking", fields: [contract_id], references: [id], onDelete: Cascade, map: "ContractParking_rental_contract_id_fkey")
  sales_contract  SalesContract?  @relation("SalesContractParking", fields: [contract_id], references: [id], onDelete: Cascade, map: "ContractParking_sales_contract_id_fkey")
  vehicle         Vehicle?       @relation(fields: [vehicle_id], references: [id])

  @@index([contract_id])
  @@index([parking_id])
  @@index([vehicle_id], map: "ContractParking_vehicle_id_fkey")
}

model Handover {
  id                 Int                @id @default(autoincrement())
  contract_id        Int                @unique
  contract_type      String
  no_of_keys_given   Int?
  no_of_cards_given  Int?
  additional_details String?
  date               DateTime
  created_at         DateTime           @default(now())
  rental_contract    RentalContract?     @relation("RentalContractHandover", fields: [contract_id], references: [id], onDelete: Cascade, map: "Handover_rental_contract_id_fkey")
  sales_contract     SalesContract?      @relation("SalesContractHandover", fields: [contract_id], references: [id], onDelete: Cascade, map: "Handover_sales_contract_id_fkey")
  documents          HandoverDocument[]
}

model HandoverDocument {
  id          Int        @id @default(autoincrement())
  handover_id Int
  doc_type_id Int
  path        String
  created_at  DateTime   @default(now())
  doc_type    KycDocType @relation(fields: [doc_type_id], references: [id], onDelete: NoAction)
  handover    Handover   @relation(fields: [handover_id], references: [id], onDelete: Cascade)

  @@index([handover_id])
  @@index([doc_type_id], map: "HandoverDocument_doc_type_id_fkey")
}

model Receipt {
  id            Int            @id @default(autoincrement())
  receipt_no    String         @unique
  date          DateTime
  contract_id   Int
  contract_type String
  invoice_id    Int?
  company_id    Int
  created_by    Int
  created_at    DateTime       @default(now())
  payments      Payment[]
  company       Company        @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator       User           @relation(fields: [created_by], references: [id], onDelete: NoAction)
  invoice       Invoice?       @relation(fields: [invoice_id], references: [id])
  rental_contract RentalContract? @relation("RentalContractReceipt", fields: [contract_id], references: [id], onDelete: NoAction, map: "Receipt_rental_contract_id_fkey")
  sales_contract  SalesContract?  @relation("SalesContractReceipt", fields: [contract_id], references: [id], onDelete: NoAction, map: "Receipt_sales_contract_id_fkey")

  @@index([receipt_no])
  @@index([contract_id])
  @@index([company_id])
  @@index([created_by], map: "Receipt_created_by_fkey")
  @@index([invoice_id], map: "Receipt_invoice_id_fkey")
}

model Payment {
  id               Int           @id @default(autoincrement())
  receipt_id       Int
  payment_type     String
  amount_incl      Float
  status           String
  instrument_no    String?
  description      String?
  returned_on      DateTime?
  vat_amount       Float?
  payment_under_id Int?
  created_at       DateTime      @default(now())
  cheque           Cheque?
  payment_under    PaymentUnder? @relation(fields: [payment_under_id], references: [id])
  receipt          Receipt       @relation(fields: [receipt_id], references: [id], onDelete: Cascade)

  @@index([receipt_id])
  @@index([payment_under_id], map: "Payment_payment_under_id_fkey")
}

model Cheque {
  id           Int       @id @default(autoincrement())
  payment_id   Int       @unique
  date         DateTime
  is_deposited Boolean   @default(false)
  is_received  Boolean   @default(false)
  deposited_on DateTime?
  cleared_on   DateTime?
  bank_name    String?
  created_at   DateTime  @default(now())
  payment      Payment   @relation(fields: [payment_id], references: [id], onDelete: Cascade)

  @@index([payment_id])
}

model PaymentUnder {
  id         Int       @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime  @default(now())
  payments   Payment[]
  company    Company   @relation(fields: [company_id], references: [id], onDelete: NoAction)

  @@index([company_id])
}

model Invoice {
  id            Int       @id @default(autoincrement())
  invoice_no    String    @unique
  contract_id   Int
  contract_type String
  amount        Float
  due_date      DateTime
  status        String    @default("pending")
  created_at    DateTime  @default(now())
  receipts      Receipt[]

  @@index([invoice_no])
}

model Lead {
  id                   Int                     @id @default(autoincrement())
  uuid                 String                  @unique @default(uuid())
  name                 String
  email                String
  mobile_no            String
  whatsapp_no          String?
  property_type        String
  interest_type        String
  min_price            Float
  max_price            Float
  description          String?
  address              String?
  status_id            Int?
  activity_source_id   Int
  assigned_to          Int?
  company_id           Int
  created_by           Int
  created_at           DateTime                @default(now())
  activity_source      ActivitySource          @relation(fields: [activity_source_id], references: [id], onDelete: NoAction)
  assigned_user        User?                   @relation("AssignedLeads", fields: [assigned_to], references: [id])
  company              Company                 @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator              User                    @relation("CreatedLeads", fields: [created_by], references: [id], onDelete: NoAction)
  status               LeadStatus?             @relation(fields: [status_id], references: [id])
  followups            LeadFollowup[]
  preferred_amenities  LeadPreferredAmenity[]
  preferred_areas      LeadPreferredArea[]
  preferred_unit_types LeadPreferredunitType[]
  viewings             PropertyViewing[]
  favorites            UnitFavorite[]

  @@index([uuid])
  @@index([email])
  @@index([company_id])
  @@index([status_id])
  @@index([activity_source_id], map: "Lead_activity_source_id_fkey")
  @@index([assigned_to], map: "Lead_assigned_to_fkey")
  @@index([created_by], map: "Lead_created_by_fkey")
}

model LeadStatus {
  id           Int            @id @default(autoincrement())
  name         String
  category     String
  is_qualified Boolean        @default(false)
  company_id   Int
  created_at   DateTime       @default(now())
  leads        Lead[]
  followups    LeadFollowup[]
  company      Company        @relation(fields: [company_id], references: [id], onDelete: NoAction)

  @@index([company_id])
}

model ActivitySource {
  id         Int      @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime @default(now())
  company    Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  leads      Lead[]

  @@index([company_id])
}

model LeadFollowup {
  id                 Int          @id @default(autoincrement())
  uuid               String       @unique @default(uuid())
  lead_id            Int
  status_id          Int
  type_id            Int
  date               DateTime
  remarks            String
  next_followup_date DateTime?
  company_id         Int
  created_by         Int
  created_at         DateTime     @default(now())
  company            Company      @relation("LeadFollowupCompany", fields: [company_id], references: [id], onDelete: NoAction)
  creator            User         @relation(fields: [created_by], references: [id], onDelete: NoAction)
  lead               Lead         @relation(fields: [lead_id], references: [id], onDelete: Cascade)
  status             LeadStatus   @relation(fields: [status_id], references: [id], onDelete: NoAction)
  followup_type      FollowupType @relation(fields: [type_id], references: [id], onDelete: NoAction)

  @@index([lead_id])
  @@index([uuid])
  @@index([company_id], map: "LeadFollowup_company_id_fkey")
  @@index([created_by], map: "LeadFollowup_created_by_fkey")
  @@index([status_id], map: "LeadFollowup_status_id_fkey")
  @@index([type_id], map: "LeadFollowup_type_id_fkey")
}

model FollowupType {
  id         Int            @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime       @default(now())
  company    Company        @relation(fields: [company_id], references: [id], onDelete: NoAction)
  followups  LeadFollowup[]

  @@index([company_id])
}

model LeadPreferredArea {
  id      Int  @id @default(autoincrement())
  lead_id Int
  area_id Int
  area    Area @relation(fields: [area_id], references: [id], onDelete: NoAction)
  lead    Lead @relation(fields: [lead_id], references: [id], onDelete: Cascade)

  @@unique([lead_id, area_id])
  @@index([area_id], map: "LeadPreferredArea_area_id_fkey")
}

model LeadPreferredunitType {
  id           Int      @id @default(autoincrement())
  lead_id      Int
  unit_type_id Int
  lead         Lead     @relation(fields: [lead_id], references: [id], onDelete: Cascade)
  unit_type    unitType @relation(fields: [unit_type_id], references: [id], onDelete: NoAction)

  @@unique([lead_id, unit_type_id])
  @@index([unit_type_id], map: "LeadPreferredunitType_unit_type_id_fkey")
}

model LeadPreferredAmenity {
  id         Int     @id @default(autoincrement())
  lead_id    Int
  amenity_id Int
  amenity    Amenity @relation(fields: [amenity_id], references: [id], onDelete: NoAction)
  lead       Lead    @relation(fields: [lead_id], references: [id], onDelete: Cascade)

  @@unique([lead_id, amenity_id])
  @@index([amenity_id], map: "LeadPreferredAmenity_amenity_id_fkey")
}

model Request {
  id          Int           @id @default(autoincrement())
  request_no  String        @unique
  type_id     Int
  status_id   Int
  description String
  tenant_id   Int?
  landlord_id Int?
  company_id  Int
  created_by  Int
  created_at  DateTime      @default(now())
  updated_at  DateTime      @updatedAt
  company     Company       @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator     User          @relation(fields: [created_by], references: [id], onDelete: NoAction)
  landlord    Landlord?     @relation(fields: [landlord_id], references: [id])
  status      RequestStatus @relation(fields: [status_id], references: [id], onDelete: NoAction)
  tenant      Tenant?       @relation(fields: [tenant_id], references: [id])
  type        RequestType   @relation(fields: [type_id], references: [id], onDelete: NoAction)

  @@index([request_no])
  @@index([company_id])
  @@index([created_by], map: "Request_created_by_fkey")
  @@index([landlord_id], map: "Request_landlord_id_fkey")
  @@index([status_id], map: "Request_status_id_fkey")
  @@index([tenant_id], map: "Request_tenant_id_fkey")
  @@index([type_id], map: "Request_type_id_fkey")
}

model RequestType {
  id         Int       @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime  @default(now())
  requests   Request[]
  company    Company   @relation(fields: [company_id], references: [id], onDelete: NoAction)

  @@index([company_id])
}

model RequestStatus {
  id         Int       @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime  @default(now())
  requests   Request[]
  company    Company   @relation(fields: [company_id], references: [id], onDelete: NoAction)

  @@index([company_id])
}

model Ticket {
  id            Int               @id @default(autoincrement())
  ticket_no     String            @unique
  type_id       Int
  status_id     Int
  description   String
  tenant_id     Int?
  landlord_id   Int?
  unit_id       Int?
  company_id    Int
  assigned_to   Int?
  created_by    Int
  created_at    DateTime          @default(now())
  updated_at    DateTime          @updatedAt
  assigned_user User?             @relation("AssignedTickets", fields: [assigned_to], references: [id])
  company       Company           @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator       User              @relation("CreatedTickets", fields: [created_by], references: [id], onDelete: NoAction)
  landlord      Landlord?         @relation(fields: [landlord_id], references: [id])
  status        MaintenanceStatus @relation(fields: [status_id], references: [id], onDelete: NoAction)
  tenant        Tenant?           @relation(fields: [tenant_id], references: [id])
  type          MaintenanceType   @relation(fields: [type_id], references: [id], onDelete: NoAction)
  unit          unit?             @relation(fields: [unit_id], references: [id])
  comments      TicketComment[]
  followups     TicketFollowup[]

  @@index([ticket_no])
  @@index([company_id])
  @@index([assigned_to], map: "Ticket_assigned_to_fkey")
  @@index([created_by], map: "Ticket_created_by_fkey")
  @@index([landlord_id], map: "Ticket_landlord_id_fkey")
  @@index([status_id], map: "Ticket_status_id_fkey")
  @@index([tenant_id], map: "Ticket_tenant_id_fkey")
  @@index([type_id], map: "Ticket_type_id_fkey")
  @@index([unit_id], map: "Ticket_unit_id_fkey")
}

model MaintenanceType {
  id         Int      @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime @default(now())
  company    Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  tickets    Ticket[]

  @@index([company_id])
}

model MaintenanceStatus {
  id         Int              @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime         @default(now())
  company    Company          @relation(fields: [company_id], references: [id], onDelete: NoAction)
  tickets    Ticket[]
  followups  TicketFollowup[]

  @@index([company_id])
}

model TicketComment {
  id         Int      @id @default(autoincrement())
  ticket_id  Int
  comment    String
  created_by Int
  created_at DateTime @default(now())
  creator    User     @relation(fields: [created_by], references: [id], onDelete: NoAction)
  ticket     Ticket   @relation(fields: [ticket_id], references: [id], onDelete: Cascade)

  @@index([ticket_id])
  @@index([created_by], map: "TicketComment_created_by_fkey")
}

model TicketFollowup {
  id         Int               @id @default(autoincrement())
  ticket_id  Int
  remarks    String
  status_id  Int
  created_by Int
  created_at DateTime          @default(now())
  creator    User              @relation(fields: [created_by], references: [id], onDelete: NoAction)
  status     MaintenanceStatus @relation(fields: [status_id], references: [id], onDelete: NoAction)
  ticket     Ticket            @relation(fields: [ticket_id], references: [id], onDelete: Cascade)

  @@index([ticket_id])
  @@index([created_by], map: "TicketFollowup_created_by_fkey")
  @@index([status_id], map: "TicketFollowup_status_id_fkey")
}

model Complaint {
  id           Int                 @id @default(autoincrement())
  complaint_no String              @unique
  type         String
  title        String
  description  String
  status_id    Int
  tenant_id    Int?
  landlord_id  Int?
  company_id   Int
  created_by   Int
  created_at   DateTime            @default(now())
  updated_at   DateTime            @updatedAt
  company      Company             @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator      User                @relation(fields: [created_by], references: [id], onDelete: NoAction)
  landlord     Landlord?           @relation(fields: [landlord_id], references: [id])
  status       ComplaintStatus     @relation(fields: [status_id], references: [id], onDelete: NoAction)
  tenant       Tenant?             @relation(fields: [tenant_id], references: [id])
  followups    ComplaintFollowup[]

  @@index([complaint_no])
  @@index([company_id])
  @@index([created_by], map: "Complaint_created_by_fkey")
  @@index([landlord_id], map: "Complaint_landlord_id_fkey")
  @@index([status_id], map: "Complaint_status_id_fkey")
  @@index([tenant_id], map: "Complaint_tenant_id_fkey")
}

model ComplaintStatus {
  id         Int                 @id @default(autoincrement())
  name       String
  company_id Int
  created_at DateTime            @default(now())
  complaints Complaint[]
  followups  ComplaintFollowup[]
  company    Company             @relation(fields: [company_id], references: [id], onDelete: NoAction)

  @@index([company_id])
}

model ComplaintFollowup {
  id           Int             @id @default(autoincrement())
  complaint_id Int
  remarks      String
  status_id    Int
  created_by   Int
  created_at   DateTime        @default(now())
  complaint    Complaint       @relation(fields: [complaint_id], references: [id], onDelete: Cascade)
  creator      User            @relation(fields: [created_by], references: [id], onDelete: NoAction)
  status       ComplaintStatus @relation(fields: [status_id], references: [id], onDelete: NoAction)

  @@index([complaint_id])
  @@index([created_by], map: "ComplaintFollowup_created_by_fkey")
  @@index([status_id], map: "ComplaintFollowup_status_id_fkey")
}

model Announcement {
  id           Int       @id @default(autoincrement())
  title        String
  message      String
  type         String?
  target_scope String?
  is_active    Boolean   @default(true)
  start_date   DateTime?
  end_date     DateTime?
  company_id   Int
  created_by   Int
  created_at   DateTime  @default(now())
  company      Company   @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator      User      @relation(fields: [created_by], references: [id], onDelete: NoAction)

  @@index([company_id])
  @@index([is_active])
  @@index([created_by], map: "Announcement_created_by_fkey")
}

model RentalApproval {
  id          Int      @id @default(autoincrement())
  request_no  String   @unique
  unit_id     Int
  tenant_id   Int
  status      String   @default("pending")
  remarks     String?
  company_id  Int
  created_by  Int
  approved_by Int?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  approver    User?    @relation("ApprovedApprovals", fields: [approved_by], references: [id])
  company     Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator     User     @relation("CreatedApprovals", fields: [created_by], references: [id], onDelete: NoAction)
  tenant      Tenant   @relation(fields: [tenant_id], references: [id], onDelete: NoAction)
  unit        unit     @relation(fields: [unit_id], references: [id], onDelete: NoAction)

  @@index([request_no])
  @@index([company_id])
  @@index([status])
  @@index([approved_by], map: "RentalApproval_approved_by_fkey")
  @@index([created_by], map: "RentalApproval_created_by_fkey")
  @@index([tenant_id], map: "RentalApproval_tenant_id_fkey")
  @@index([unit_id], map: "RentalApproval_unit_id_fkey")
}

model CompanySettings {
  id              Int      @id @default(autoincrement())
  company_id      Int      @unique
  logo_path       String?
  smtp_host       String?
  smtp_port       Int?
  smtp_user       String?
  smtp_password   String?
  smtp_from_email String?
  smtp_from_name  String?
  updated_at      DateTime @updatedAt
  company         Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
}

model Broker {
  id               Int              @id @default(autoincrement())
  name             String
  email            String           @unique
  phone            String
  license_number   String?
  license_expiry   DateTime?
  commission_rate  Float?
  company_id       Int
  is_active        Boolean          @default(true)
  created_at       DateTime         @default(now())
  updated_at       DateTime         @updatedAt
  company          Company          @relation(fields: [company_id], references: [id], onDelete: NoAction)
  rental_contracts RentalContract[] @relation("BrokerRental")
  sales_contracts  SalesContract[]  @relation("BrokerSales")

  @@index([company_id])
  @@index([license_number])
}

model PropertyViewing {
  id             Int      @id @default(autoincrement())
  unit_id        Int
  lead_id        Int?
  tenant_id      Int?
  viewer_name    String
  viewer_email   String
  viewer_phone   String
  viewing_date   DateTime
  viewing_time   String?
  status         String   @default("scheduled")
  notes          String?  @db.Text
  feedback       String?  @db.Text
  rating         Int?
  company_id     Int
  assigned_to    Int?
  created_by     Int
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  assigned_agent User?    @relation("AssignedViewings", fields: [assigned_to], references: [id])
  company        Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  creator        User     @relation("CreatedViewings", fields: [created_by], references: [id], onDelete: NoAction)
  lead           Lead?    @relation(fields: [lead_id], references: [id])
  tenant         Tenant?  @relation(fields: [tenant_id], references: [id])
  unit           unit     @relation(fields: [unit_id], references: [id], onDelete: NoAction)

  @@index([unit_id])
  @@index([viewing_date])
  @@index([company_id])
  @@index([status])
  @@index([assigned_to], map: "PropertyViewing_assigned_to_fkey")
  @@index([created_by], map: "PropertyViewing_created_by_fkey")
  @@index([lead_id], map: "PropertyViewing_lead_id_fkey")
  @@index([tenant_id], map: "PropertyViewing_tenant_id_fkey")
}

model UnitFavorite {
  id         Int      @id @default(autoincrement())
  unit_id    Int
  user_id    Int?
  lead_id    Int?
  email      String?
  notes      String?
  created_at DateTime @default(now())
  lead       Lead?    @relation(fields: [lead_id], references: [id], onDelete: Cascade)
  unit       unit     @relation(fields: [unit_id], references: [id], onDelete: Cascade)
  user       User?    @relation("UserFavorites", fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([unit_id, user_id], name: "unit_id_user_id")
  @@unique([unit_id, lead_id], name: "unit_id_lead_id")
  @@index([unit_id])
  @@index([user_id])
  @@index([lead_id], map: "UnitFavorite_lead_id_fkey")
}

model PropertyInspection {
  id               Int      @id @default(autoincrement())
  unit_id          Int
  contract_id      Int?
  contract_type    String?
  inspection_type  String
  inspection_date  DateTime
  inspector_name   String
  inspector_notes  String?  @db.Text
  condition_rating Int?
  photos           String?
  defects_found    String?  @db.Text
  recommendations  String?  @db.Text
  company_id       Int
  created_by       Int
  created_at       DateTime @default(now())
  company          Company  @relation("PropertyInspectionCompany", fields: [company_id], references: [id], onDelete: NoAction)
  creator          User     @relation(fields: [created_by], references: [id], onDelete: NoAction)
  unit             unit     @relation(fields: [unit_id], references: [id], onDelete: NoAction)

  @@index([unit_id])
  @@index([inspection_date])
  @@index([company_id])
  @@index([created_by], map: "PropertyInspection_created_by_fkey")
}

model PropertyValuation {
  id               Int      @id @default(autoincrement())
  unit_id          Int
  valuation_type   String
  estimated_rent   Float?
  estimated_sale   Float?
  valuation_date   DateTime
  valuer_name      String
  valuer_notes     String?  @db.Text
  market_analysis  String?  @db.Text
  comparable_units String?
  company_id       Int
  created_by       Int
  created_at       DateTime @default(now())
  company          Company  @relation("PropertyValuationCompany", fields: [company_id], references: [id], onDelete: NoAction)
  creator          User     @relation(fields: [created_by], references: [id], onDelete: NoAction)
  unit             unit     @relation(fields: [unit_id], references: [id], onDelete: NoAction)

  @@index([unit_id])
  @@index([valuation_date])
  @@index([company_id])
  @@index([created_by], map: "PropertyValuation_created_by_fkey")
}

model PropertyInsurance {
  id                 Int       @id @default(autoincrement())
  unit_id            Int
  insurance_type     String
  insurance_provider String
  policy_number      String
  coverage_amount    Float
  premium_amount     Float
  start_date         DateTime
  end_date           DateTime
  renewal_date       DateTime?
  is_active          Boolean   @default(true)
  documents          String?
  company_id         Int
  created_by         Int
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt
  company            Company   @relation("PropertyInsuranceCompany", fields: [company_id], references: [id], onDelete: NoAction)
  creator            User      @relation(fields: [created_by], references: [id], onDelete: NoAction)
  unit               unit      @relation(fields: [unit_id], references: [id], onDelete: NoAction)

  @@index([unit_id])
  @@index([policy_number])
  @@index([company_id])
  @@index([is_active])
  @@index([created_by], map: "PropertyInsurance_created_by_fkey")
}

model PropertyMaintenanceHistory {
  id                    Int       @id @default(autoincrement())
  unit_id               Int
  maintenance_type      String
  description           String    @db.Text
  cost                  Float?
  vendor_name           String?
  maintenance_date      DateTime
  next_maintenance_date DateTime?
  documents             String?
  company_id            Int
  created_by            Int
  created_at            DateTime  @default(now())
  company               Company   @relation("PropertyMaintenanceHistoryCompany", fields: [company_id], references: [id], onDelete: NoAction)
  creator               User      @relation(fields: [created_by], references: [id], onDelete: NoAction)
  unit                  unit      @relation(fields: [unit_id], references: [id], onDelete: NoAction)

  @@index([unit_id])
  @@index([maintenance_date])
  @@index([company_id])
  @@index([created_by], map: "PropertyMaintenanceHistory_created_by_fkey")
}

model PropertyNotification {
  id                Int      @id @default(autoincrement())
  unit_id           Int?
  user_id           Int?
  notification_type String
  title             String
  message           String   @db.Text
  is_read           Boolean  @default(false)
  action_url        String?
  company_id        Int
  created_at        DateTime @default(now())
  company           Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  unit              unit?    @relation("UnitNotifications", fields: [unit_id], references: [id], onDelete: Cascade)
  user              User?    @relation("UserNotifications", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([is_read])
  @@index([company_id])
  @@index([notification_type])
  @@index([unit_id], map: "PropertyNotification_unit_id_fkey")
}

model PropertyAnalytics {
  id              Int      @id @default(autoincrement())
  unit_id         Int
  date            DateTime
  views_count     Int      @default(0)
  favorites_count Int      @default(0)
  inquiries_count Int      @default(0)
  viewings_count  Int      @default(0)
  offers_count    Int      @default(0)
  company_id      Int
  created_at      DateTime @default(now())
  company         Company  @relation(fields: [company_id], references: [id], onDelete: NoAction)
  unit            unit     @relation("UnitAnalytics", fields: [unit_id], references: [id], onDelete: Cascade)

  @@unique([unit_id, date], name: "unit_id_date")
  @@index([unit_id])
  @@index([date])
  @@index([company_id])
}
